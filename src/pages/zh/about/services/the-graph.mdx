# The Graph

åœ¨æ„å»º dApp æ—¶è·å–æ™ºèƒ½åˆçº¦çš„å†å²æ•°æ®å¾€å¾€ä»¤äººå¤´ç–¼ã€‚[The Graph](https://thegraph.com/) é€šè¿‡å­å›¾ï¼ˆSubgraphï¼‰APIï¼Œä¸ºæ™ºèƒ½åˆçº¦æ•°æ®æä¾›ä¾¿æ·çš„æŸ¥è¯¢æ–¹å¼ã€‚å…¶åŸºç¡€è®¾æ–½ä¾èµ–å»ä¸­å¿ƒåŒ–ç´¢å¼•è€…ç½‘ç»œï¼Œå¯è®©ä½ çš„ dApp çœŸæ­£å®ç°å»ä¸­å¿ƒåŒ–ã€‚

## å¿«é€Ÿä¸Šæ‰‹

è¿™äº›å­å›¾åªéœ€å‡ åˆ†é’Ÿå³å¯æ­å»ºã€‚æŒ‰ç…§ä»¥ä¸‹ä¸‰æ­¥å¼€å§‹ï¼š

1. åˆå§‹åŒ–å­å›¾é¡¹ç›®
2. éƒ¨ç½²å¹¶å‘å¸ƒ
3. åœ¨ dApp ä¸­æŸ¥è¯¢

ä»¥ä¸‹ä¸ºè¯¦ç»†æ­¥éª¤ï¼š

## 1. åˆå§‹åŒ–å­å›¾é¡¹ç›®

### åœ¨ Subgraph Studio åˆ›å»ºå­å›¾

è¿›å…¥ [Subgraph Studio](https://thegraph.com/studio/) å¹¶è¿æ¥é’±åŒ…ã€‚è¿æ¥åç‚¹å‡» â€œCreate a Subgraphâ€ å³å¯å¼€å§‹ã€‚å‘½åæ—¶å»ºè®®ä½¿ç”¨æ ‡é¢˜æ ¼å¼ï¼ˆTitle Caseï¼‰ï¼Œä¾‹å¦‚ â€œSubgraph Name Chain Nameâ€ã€‚

![Create a Subgraph](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/main/img/studio-create-subgraph.png)

åˆ›å»ºåä¼šè¿›å…¥å­å›¾é¡µé¢ï¼Œå³ä¾§åˆ—å‡ºäº†æ‰€éœ€çš„ CLI å‘½ä»¤ï¼š

![CLI commands](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/zetachain/img/studio-graphcli-commands.png)

### å®‰è£… Graph CLI

åœ¨æœ¬åœ°è¿è¡Œï¼š

```
npm install -g @graphprotocol/graph-cli
```

### åˆå§‹åŒ–å­å›¾

å¯ç›´æ¥ä»å­å›¾é¡µé¢å¤åˆ¶å‘½ä»¤ï¼ˆå«ä¸“å± slugï¼‰ï¼š

```
graph init --studio <SUBGRAPH_SLUG>
```

CLI ä¼šæç¤ºä½ å¡«å†™ç›¸å…³ä¿¡æ¯ï¼š

![cli sample](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/zetachain/img/cli-sample.png)

ç¡®ä¿åˆçº¦å·²åœ¨åŒºå—æµè§ˆå™¨é€šè¿‡éªŒè¯ï¼ŒCLI ä¼šè‡ªåŠ¨è·å– ABI å¹¶å®Œæˆåˆå§‹åŒ–ã€‚å¦‚æœªæˆåŠŸè·å– ABIï¼Œå¯é‡è¯•è§£å†³ã€‚

## 2. éƒ¨ç½²å¹¶å‘å¸ƒ

### éƒ¨ç½²åˆ° Subgraph Studio

å…ˆè¿è¡Œï¼š

```bash
$ graph codegen
$ graph build
```

æ¥ç€è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®¤è¯ä¸éƒ¨ç½²ï¼ˆå¯ä»å­å›¾é¡µé¢å¤åˆ¶ï¼ŒåŒ…å«ä¸“å± deploy key ä¸ slugï¼‰ï¼š

```bash
$ graph auth --studio <DEPLOY_KEY>
$ graph deploy --studio <SUBGRAPH_SLUG>
```

ç³»ç»Ÿä¼šè¦æ±‚è¾“å…¥ç‰ˆæœ¬æ ‡ç­¾ï¼Œå¯å¡«å†™ `v0.0.1` ç­‰è‡ªå®šä¹‰æ ¼å¼ã€‚

### æµ‹è¯•å­å›¾

å¯åœ¨ Playground åŒºåŸŸæ‰§è¡Œç¤ºä¾‹æŸ¥è¯¢ã€‚è¯¦æƒ…é¡µä¼šæ˜¾ç¤º API ç«¯ç‚¹ï¼Œå¯åœ¨ dApp ä¸­ä½¿ç”¨è¯¥ç«¯ç‚¹ã€‚

![Playground](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/zetachain/img/studio-playground.png)

### å°†å­å›¾å‘å¸ƒåˆ° The Graph å»ä¸­å¿ƒåŒ–ç½‘ç»œ

å½“å­å›¾å‡†å¤‡ä¸Šçº¿æ—¶ï¼Œå¯å‘å¸ƒåˆ°å»ä¸­å¿ƒåŒ–ç½‘ç»œã€‚åœ¨ Subgraph Studio çš„å­å›¾é¡µé¢ç‚¹å‡» â€œPublishâ€ï¼š

![publish button](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/zetachain/img/studio-publish-button.png)

éœ€è¦åœ¨ Arbitrum One ä¸Šæ”¯ä»˜äº¤æ˜“è´¹ç”¨ â€”â€” The Graph çš„æ™ºèƒ½åˆçº¦å‡éƒ¨ç½²åœ¨ Arbitrum Oneï¼Œå³ä¾¿ä½ çš„å­å›¾ç´¢å¼•çš„æ˜¯å…¶ä»–é“¾æ•°æ®ã€‚

![Publish screen](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/zetachain/img/studio-publish-modal.png)

> **æç¤ºï¼š** å‘å¸ƒæ—¶è‹¥çœ‹åˆ° â€œPartial Indexer Supportâ€ è­¦å‘Šï¼Œè¡¨ç¤ºè¯¥é“¾ä¸Šçš„å­å›¾ç›®å‰ä»…ç”± The Graph é»˜è®¤ç´¢å¼•è€…ç´¢å¼•ï¼Œå°šæ— ç‹¬ç«‹ç´¢å¼•è€…å‚ä¸ã€‚æµ‹è¯•ç½‘é€šå¸¸å­˜åœ¨æ­¤é™åˆ¶ã€‚ä¸»ç½‘ä¸Šè¯¥æç¤ºä¼šåœ¨é“¾å¯ç”¨ç´¢å¼•è€…å¥–åŠ±åæ¶ˆå¤±ï¼Œå±Šæ—¶å¯å¸å¼•æ›´å¤šç´¢å¼•è€…æ”¯æŒä½ çš„å­å›¾ã€‚

## 3. æŸ¥è¯¢å­å›¾

æ­å–œï¼ä½ ç°åœ¨å¯ä»¥åœ¨å»ä¸­å¿ƒåŒ–ç½‘ç»œä¸ŠæŸ¥è¯¢å­å›¾ã€‚

å¯¹äºå»ä¸­å¿ƒåŒ–ç½‘ç»œä¸Šçš„ä»»æ„å­å›¾ï¼Œåªéœ€å‘å…¶ Explorer é¡µé¢é¡¶éƒ¨çš„æŸ¥è¯¢ URL å‘é€ GraphQL è¯·æ±‚å³å¯ã€‚

ä¸‹ä¾‹æ¥è‡ª Messari çš„ [CryptoPunks Ethereum å­å›¾](https://thegraph.com/explorer/subgraphs/HdVdERFUe8h61vm2fDyycHgxjsde5PbB832NHgJfZNqK)ï¼š

![Query URL](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/main/img/explorer-query-url.png)

è¯¥å­å›¾çš„æŸ¥è¯¢ URL ä¸ºï¼š

`https://gateway-arbitrum.network.thegraph.com/api/`**[api-key]**`/subgraphs/id/HdVdERFUe8h61vm2fDyycgxjsde5PbB832NHgJfZNqK`

å°†ä½ çš„ API Key å¡«å…¥åå³å¯å‘è¯¥ç«¯ç‚¹å‘é€ GraphQL æŸ¥è¯¢ã€‚

### è·å– API Key

![API keys](https://raw.githubusercontent.com/alinobrasil/the_graph_getting_started/refs/heads/main/img/getting-api-key.png)

åœ¨ Subgraph Studio é¡µé¢é¡¶éƒ¨é€‰æ‹© â€œAPI Keysâ€ èœå•å³å¯åˆ›å»ºã€‚

## é™„å½•

### ç¤ºä¾‹æŸ¥è¯¢

ä»¥ä¸‹æŸ¥è¯¢è¿”å›å”®ä»·æœ€é«˜çš„ CryptoPunksï¼š

```graphql
{
  trades(orderBy: priceETH, orderDirection: desc) {
    priceETH
    tokenId
  }
}
```

å°†å…¶å‘é€è‡³æŸ¥è¯¢ URL ä¼šè¿”å›å¦‚ä¸‹ç»“æœï¼š

```
{
  "data": {
    "trades": [
      {
        "priceETH": "124457.067524886018255505",
        "tokenId": "9998"
      },
      {
        "priceETH": "8000",
        "tokenId": "5822"
      },
//      ...
```

<aside>
ğŸ’¡ å°çŸ¥è¯†ï¼šåœ¨ [CryptoPunks å®˜ç½‘](https://cryptopunks.app/cryptopunks/topsales) ä¸Šçœ‹åˆ°çš„æœ€é«˜æˆäº¤ä»·æ˜¯ Punk #5822ï¼Œè€Œä¸æ˜¯ #9998ã€‚åŸå› æ˜¯å®˜æ–¹å±è”½äº†é€šè¿‡é—ªç”µè´·å®Œæˆçš„é‚£ç¬”äº¤æ˜“ã€‚
</aside>

### ç¤ºä¾‹ä»£ç 

```jsx
const axios = require('axios');

const graphqlQuery = `{
  trades(orderBy: priceETH, orderDirection: desc) {
    priceETH
    tokenId
  }
}`;
const queryUrl = 'https://gateway-arbitrum.network.thegraph.com/api/[api-key]/subgraphs/id/HdVdERFUe8h61vm2fDyycHgxjsde5PbB832NHgJfZNqK'

const graphQLRequest = {
  method: 'post',
  url: queryUrl,
  data: {
    query: graphqlQuery,
  },
};

// å‘é€ GraphQL æŸ¥è¯¢
axios(graphQLRequest)
  .then((response) => {
    // åœ¨æ­¤å¤„ç†å“åº”
    const data = response.data.data
    console.log(data)

  })
  .catch((error) => {
    // å¤„ç†é”™è¯¯
    console.error(error);
  });
```

### æ›´å¤šèµ„æº

- æƒ³ä¼˜åŒ–ä¸è‡ªå®šä¹‰å­å›¾ä»¥æå‡æ€§èƒ½ï¼Œå¯é˜…è¯»[åˆ›å»ºå­å›¾æŒ‡å—](https://thegraph.com/docs/en/developing/creating-a-subgraph/)ã€‚
- è‹¥éœ€äº†è§£æ›´å¤šæŸ¥è¯¢æ–¹æ³•ï¼Œè¯·å‚è€ƒ[æŸ¥è¯¢æ–‡æ¡£](https://thegraph.com/docs/en/querying/querying-the-graph/)ã€‚***

