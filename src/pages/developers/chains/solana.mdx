To interact with universal applications from Solana, use the Solana Gateway. The
Solana Gateway supports:

- Depositing SOL to a universal app or an account on ZetaChain
- Depositing supported SPL tokens
- Depositing SOL and calling a universal app
- Depositing supported SPL tokens and calling a universal app

## Deposit SOL

To deposit SOL to an EOA or a universal contract, call the `deposit` instruction
of the Solana Gateway program:

```rust
pub fn deposit(ctx: Context<Deposit>, amount: u64, receiver: [u8; 20]) -> Result<()>
```

The `deposit` instruction accepts SOL (in lamports) which will then be sent to a
`receiver` on ZetaChain.

The `receiver` can be either an externally-owned account (EOA) or a universal
app address on ZetaChain. Even if the receiver is a universal app contract with
the standard `receive` function, the `deposit` instruction will not trigger a
contract call. If you want to deposit and call a universal app, use the
`deposit_and_call` instruction instead.

After the deposit is processed, the receiver receives the [ZRC-20
version](/developers/tokens/zrc20) of the deposited tokenâ€”for example, ZRC-20
SOL.

## Deposit SPL Tokens

To deposit SPL tokens to an EOA or a universal contract, call the
`deposit_spl_token` instruction:

```rust
pub fn deposit_spl_token(ctx: Context<DepositSplToken>, amount: u64, receiver: [u8; 20]) -> Result<()>
```

Only [supported SPL tokens](/developers/tokens/zrc20) can be deposited. The
receiver gets the ZRC-20 version of the deposited token (e.g., ZRC-20 USDC.SOL).

The `amount` specifies the quantity of SPL tokens to deposit.

## Deposit SOL and Call a Universal App

To deposit SOL and call a universal app contract, use the `deposit_and_call`
instruction:

```rust
pub fn deposit_and_call(ctx: Context<Deposit>, amount: u64, receiver: [u8; 20], message: Vec<u8>) -> Result<()>
```

After the cross-chain transaction is processed, the `onCall` function of the
universal app contract is executed.

The `receiver` must be the address of a universal app contract.

When calling a universal app, the `message` is passed to `onCall`.

## Deposit SPL Tokens and Call a Universal App

The `deposit_spl_token_and_call` instruction can be used to call a universal app
contract and send SPL tokens:

```rust
pub fn deposit_spl_token_and_call(ctx: Context<DepositSplToken>, amount: u64, receiver: [u8; 20], message: Vec<u8>) -> Result<()>
```

Here, `amount` specifies the quantity of SPL tokens to deposit.

In the current version of the protocol, only one SPL token can be deposited at a
time.

## Message Formatting

We recommend formatting the message payload using ABI encoding so that it can be
easily decoded in a universal application on ZetaChain. ABI encoding ensures
compatibility and standardization when transmitting data across different
platforms.

**Example of ABI Encoding:**

```typescript
const ethers = require("ethers");

// Define the parameter types and values
const paramTypes = ["uint256", "string"];
const paramValues = [12345, "Hello, ZetaChain!"];

// Encode the parameters
const encodedParams = ethers.utils.defaultAbiCoder.encode(paramTypes, paramValues);

// Convert to Buffer or Uint8Array as needed
const paramsBuffer = Buffer.from(encodedParams.slice(2), "hex"); // Remove '0x' prefix
```

## Additional Information

- **Lamports and SOL:** 1 SOL equals 1,000,000,000 lamports. Ensure you convert
  SOL amounts to lamports when specifying the `amount` parameter.
- **Program Derived Account (PDA):** The PDA is a special account used by the
  Solana Gateway program to manage deposited funds securely.
- **SPL Token Whitelist:** SPL tokens must be whitelisted before they can be
  deposited through the gateway.
- **Deposit Fee:** A deposit fee of 2,000,000 lamports (0.002 SOL) is charged
  for all deposits.

## Error Handling

The Solana Gateway program includes several error codes to handle different
failure scenarios:

- `SignerIsNotAuthority`: The signer is not authorized to perform the action.
- `DepositPaused`: Deposits are currently paused.
- `NonceMismatch`: The provided nonce does not match the expected nonce.
- `TSSAuthenticationFailed`: The TSS signature verification failed.
- `DepositToAddressMismatch`: The deposit destination address does not match.
- `MessageHashMismatch`: The message hash verification failed.
- `MemoLengthExceeded`: The memo length exceeds the maximum allowed size.
- `SPLAtaAndMintAddressMismatch`: The SPL token account address does not match
  the expected address.
- `EmptyReceiver`: The receiver address is empty.
- `InvalidInstructionData`: The instruction data is invalid.

## Revert Transactions

The Solana Gateway supports transaction reverting in case of failures. If a
cross-chain call fails on the ZetaChain side, the deposited tokens will be
reverted back to the original sender on Solana.

To learn more about using the Solana Gateway in practice to deposit to and call
universal apps, check out [the Solana tutorial](/developers/tutorials/solana).
