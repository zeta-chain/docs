In this tutorial you will create a simple universal app deployed on ZetaChain,
which emits when called from a connected chain.

By the end of this tutorial, you will have learned how to:

- Build a simple universal app
- Deploy the universal app on localnet
- Use the Gateway on a connected chain to call a universal app

<iframe
  style={{ border: "1px solid rgba(0,0,0,.1)", marginTop: "2rem", borderRadius: "0.5rem" }}
  width="100%"
  height="450"
  src="https://embed.figma.com/board/4ZIdAmKA2NmzqM6bpCWmxO/Protocol-%7C-Tutorial%3A-Hello?node-id=0-1&embed-host=share"
  allowfullscreen
></iframe>

## Set Up Your Environment

Start by creating a project and installing the necessary dependencies:

```bash
npx zetachain@latest new --project hello
cd hello
yarn
```

## Universal Contract

A universal app is a contract that inherits from `UniversalContract` interface.

```solidity filename="contracts/Universal.sol"
// SPDX-License-Identifier: MIT
pragma solidity 0.8.26;

import "@zetachain/protocol-contracts/contracts/zevm/GatewayZEVM.sol";

contract Universal is UniversalContract {
    GatewayZEVM public immutable gateway;

    event HelloEvent(string, string);
    error Unauthorized();

    modifier onlyGateway() {
        if (msg.sender != address(gateway)) revert Unauthorized();
        _;
    }

    constructor(address payable gatewayAddress) {
        gateway = GatewayZEVM(gatewayAddress);
    }

    function onCall(
        MessageContext calldata context,
        address zrc20,
        uint256 amount,
        bytes calldata message
    ) external override onlyGateway {
        string memory name = abi.decode(message, (string));
        emit HelloEvent("Hello: ", name);
    }
}
```

The constructor accepts the ZetaChain's Gateway address and saves it into a
state variable. Gateway is used to make outgoing contract calls and token
withdrawals.

A universal contract must implement the `onCall` function. `onCall` is a
function that gets triggered when the contract receives a call from a connected
chain through the Gateway. This function processes the incoming data, which
includes:

- `context`: A `MessageContext` struct containing:
  - `chainID`: The integer ID of the connected chain from which the cross-chain
    call originated.
  - `sender`: The address (EOA or contract) that initiated the gateway call on
    the connected chain.
  - `origin`: deprecated.
- `zrc20`: The address of the ZRC-20 token representing the asset from the
  source chain.
- `amount`: The number of tokens transferred.
- `message`: The encoded data payload.

In this example, `onCall` simply decodes the message into a variable and emits
an event.

`onCall` should only be called by the Gateway to ensure that it is only called
as a response to a call on a connected chain and that you can trust the values
of the function parameters.

## Options 1: Deploy on Localnet

[Localnet](/reference/localnet) is a local development environment, which
simulates the behavior of Gateways deployed on multiple EVM blockchains. Start
localnet:

```
npx zetachain localnet start
```

```
npx hardhat compile --force
```

To deploy a universal contract, you need the ZetaChain Gateway address. You can
find it in the Localnet output or fetch it programmatically.

```
GATEWAY_ZETACHAIN=$(jq -r '.["31337"].contracts[] | select(.contractType == "gateway") | .address' ~/.zetachain/localnet/registry.json)
```

Deploy the universal contract and pass ZetaChain's Gateway address to the
constructor.

```
UNIVERSAL=$(npx hardhat deploy --network localhost --gateway "$GATEWAY_ZETACHAIN" --json | jq -r .contractAddress) && echo $UNIVERSAL
```

## Make a Call to the Universal App

To call the universal app deployed on ZetaChain from a connected chain, make a
call to the Gateway contract on a connected EVM chain. You can find it in the
Localnet output or fetch it programmatically.

```
GATEWAY_EVM=$(jq -r '.["11155112"].contracts[] | select(.contractType == "gateway") | .address' ~/.zetachain/localnet/registry.json)
```

You also need an account with tokens:

```
PRIVATE_KEY=$(jq -r '.private_keys[0]' ~/.zetachain/localnet/anvil.json)
```

Execute the `call` method on the EVM Gateway to make a call to a universal
contract on ZetaChain:

```
npx zetachain evm call \
  --rpc http://localhost:8545 \
  --gateway $GATEWAY_ZETACHAIN \
  --receiver $UNIVERSAL \
  --private-key $PRIVATE_KEY \
  --types string \
  --values hello
```

After the transaction is processed you will see an `[ZetaChain]: Event from onCall` message in the terminal where Localnet is running.

## Option 2: Deploy on Testnet

Set the private key in `.env` file:

```
PRIVATE_KEY=...
```

Deploy the contract to ZetaChain's testnet using the Gateway address from
[`Contract Addresses page`](/reference/network/contracts/).

```
UNIVERSAL=$(npx hardhat deploy --network zeta_testnet --gateway 0x6c533f7fe93fae114d0954697069df33c9b74fd7 --json | jq -r .contractAddress) && echo $UNIVERSAL
```

Make a transaction to the Gateway on the Base Sepolia testnet to make a
cross-chain call to the universal app on ZetaChain. Make sure to use Gateway
address on Base Sepolia.

```
npx zetachain evm call \
  --chain-id 84532 \
  --receiver $UNIVERSAL \
  --private-key $PRIVATE_KEY \
  --types string \
  --values hello
```

```
Transaction hash: 0xba4d93687265b8a373d61f3a386283590eaf9f6834d8723a59eec459c78c6978
```

https://sepolia.basescan.org/tx/0xba4d93687265b8a373d61f3a386283590eaf9f6834d8723a59eec459c78c6978

Track the progress of a cross-chain transaction:

```
npx zetachain query cctx --hash 0xba4d93687265b8a373d61f3a386283590eaf9f6834d8723a59eec459c78c6978
```

```
84532 → 7001 ✅ OutboundMined
CCTX:     0x22ccde616f77f9de50ab86502f6431f6da08537b8edfe6fcfaaded1d5de3327c
Tx Hash:  0xba4d93687265b8a373d61f3a386283590eaf9f6834d8723a59eec459c78c6978 (on chain 84532)
Tx Hash:  0x308baafcc3c6d20e65ddbdc8bece0a9f4412986def91dcb473d0c1f56205824f (on chain 7001)
Sender:   0x4955a3F38ff86ae92A914445099caa8eA2B9bA32
Receiver: 0xE519Fcc78D59bB080668DEbF5e59cC162D445895
Message:  0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000568656c6c6f000000000000000000000000000000000000000000000000000000
```
